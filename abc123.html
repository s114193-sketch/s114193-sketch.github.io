from flask import Flask, render_template_string, request, jsonify
import random
import os

app = Flask(__name__)

# å‹µå¿—èªéŒ„è³‡æ–™åº«
quotes = [
"ç›¸ä¿¡è‡ªå·±ï¼Œä½ æ¯”æƒ³åƒä¸­æ›´å¼·å¤§ï¼",
"æ¯ä¸€å¤©éƒ½æ˜¯æ–°çš„é–‹å§‹ï¼Œæ”¾ä¸‹éå»ï¼Œæ“æŠ±ç¾åœ¨ã€‚",
"ä½ çš„åƒ¹å€¼ä¸éœ€è¦ç”±ä»–äººä¾†å®šç¾©ã€‚",
"å°å°çš„é€²æ­¥ä¹Ÿæ˜¯é€²æ­¥ï¼Œç‚ºè‡ªå·±é¼“æŒã€‚",
"ä¸–ç•Œæœƒçµ¦é‚£äº›æœ‰ç›®æ¨™å’Œé è¦‹çš„äººè®“è·¯ã€‚",
"ä¸æ˜¯çœ‹åˆ°å¸Œæœ›æ‰å …æŒï¼Œè€Œæ˜¯å …æŒäº†æ‰çœ‹åˆ°å¸Œæœ›ã€‚",
"ä½ é æ¯”è‡ªå·±æƒ³åƒçš„æ›´åŠ å‹‡æ•¢å’Œå …å¼·ã€‚",
"ç…§é¡§å¥½è‡ªå·±çš„å¿ƒéˆï¼Œå’Œç…§é¡§èº«é«”ä¸€æ¨£é‡è¦ã€‚"
]

# HTMLæ¨¡æ¿
HTML_TEMPLATE = '''
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç¾éº—å¿ƒæƒ…è£½é€ æ©Ÿ</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
.theme-dark {
background-color: #1a202c;
color: #e2e8f0;
}
.theme-light {
background-color: #f7fafc;
color: #2d3748;
}
.btn-primary {
background-color: #4299e1;
color: white;
padding: 12px 24px;
border-radius: 8px;
font-weight: bold;
border: none;
cursor: pointer;
transition: background-color 0.3s;
}
.btn-primary:hover {
background-color: #3182ce;
}
/* é–‹é—œæ¨£å¼ */
.switch {
position: relative;
display: inline-block;
width: 60px;
height: 34px;
}
.switch input {
opacity: 0;
width: 0;
height: 0;
}
.slider {
position: absolute;
cursor: pointer;
top: 0;
left: 0;
right: 0;
bottom: 0;
background-color: #ccc;
transition: .4s;
}
.slider:before {
position: absolute;
content: "";
height: 26px;
width: 26px;
left: 4px;
bottom: 4px;
background-color: white;
transition: .4s;
}
input:checked + .slider {
background-color: #4299e1;
}
input:checked + .slider:before {
transform: translateX(26px);
}
.slider.round {
border-radius: 34px;
}
.slider.round:before {
border-radius: 50%;
}
</style>
</head>
<body class="theme-light min-h-screen transition-colors duration-300">
<div class="container mx-auto px-4 py-12 max-w-3xl">
<!-- æ¨™é¡Œ -->
<header class="text-center mb-12">
<h1 class="text-4xl font-bold mb-4">ç¾éº—å¿ƒæƒ…è£½é€ æ©Ÿ</h1>
<p class="text-xl text-gray-600 dark:text-gray-300">ä»Šå¤©æƒ³è½ä»€éº¼è©±å‘¢ï¼Ÿ</p>
<p class="text-gray-500 dark:text-gray-400">è¼•è¼•ä¸€æŒ‰ï¼Œæº«æš–çš„è©±èªå°±æœƒå‡ºç¾</p>
</header>

<!-- ä¸»è¦èªéŒ„å€åŸŸ -->
<main class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 mb-12 text-center">
<div class="mb-8">
<p id="quoteDisplay" class="text-2xl leading-relaxed">{{ quote }}</p>
<p class="mt-4 text-gray-500 dark:text-gray-400">â€” åˆ¥ä¸é–‹å¿ƒå•¦</p>
</div>

<button onclick="getNewQuote()" class="btn-primary text-lg">
æ›ä¸€å¥è©± ğŸ’«
</button>
</main>

<!-- åŠŸèƒ½ç‰¹è‰² -->
<section class="mb-12">
<h2 class="text-3xl font-bold text-center mb-8">ä¸‰å€‹å°ç‰¹è‰²</h2>
<p class="text-center text-gray-600 dark:text-gray-300 mb-8">ç°¡å–®ã€æº«æš–ã€éš¨æ™‚é™ªä¼´</p>

<div class="grid grid-cols-1 md:grid-cols-3 gap-8">
<div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow text-center">
<h3 class="text-xl font-bold mb-4">ä¸€ç§’å°±å¥½</h3>
<p class="text-gray-600 dark:text-gray-300">ä¸ç”¨ç­‰å¾…ï¼Œé»ä¸€ä¸‹å°±èƒ½çœ‹åˆ°æ–°çš„è©±èª</p>
</div>
<div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow text-center">
<h3 class="text-xl font-bold mb-4">æ›å€‹å¿ƒæƒ…</h3>
<p class="text-gray-600 dark:text-gray-300">å¯ä»¥åˆ‡æ›æ·±è‰²æ¨¡å¼ï¼Œé¸æ“‡å–œæ­¡çš„é¡è‰²</p>
</div>
<div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow text-center">
<h3 class="text-xl font-bold mb-4">éš¨èº«æ”œå¸¶</h3>
<p class="text-gray-600 dark:text-gray-300">æ‰‹æ©Ÿã€å¹³æ¿ã€é›»è…¦éƒ½èƒ½ç”¨</p>
</div>
</div>
</section>

<!-- ä¸»é¡Œè¨­å®š -->
<section class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8">
<h2 class="text-3xl font-bold mb-6">ä¸»é¡Œè¨­å®š</h2>

<div class="flex items-center justify-between mb-8">
<span class="text-lg">æš—è‰²æ¨¡å¼</span>
<label class="switch">
<input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()" {{ 'checked' if dark_mode else '' }}>
<span class="slider round"></span>
</label>
</div>

<p class="text-gray-600 dark:text-gray-300">
æ‚¨çš„ä¸»é¡Œè¨­å®šæœƒè‡ªå‹•å„²å­˜ï¼Œä¸‹æ¬¡è¨ªå•æ™‚æœƒä¿æŒç›¸åŒçš„è¨­å®šã€‚
</p>
</section>

<!-- é è…³ -->
<footer class="mt-12 text-center text-gray-500 dark:text-gray-400">
<p>Designed by ç¾éº—å¿ƒæƒ…è£½é€ æ©Ÿ</p>
</footer>
</div>

<script>
// å¾æœ¬åœ°å„²å­˜ä¸­ç²å–ä¸»é¡Œè¨­å®š
let darkMode = localStorage.getItem('darkMode') === 'true' || {{ 'true' if dark_mode else 'false' }};

// åˆå§‹åŒ–ä¸»é¡Œ
function initializeTheme() {
if (darkMode) {
document.body.classList.remove('theme-light');
document.body.classList.add('theme-dark');
document.getElementById('darkModeToggle').checked = true;
} else {
document.body.classList.remove('theme-dark');
document.body.classList.add('theme-light');
document.getElementById('darkModeToggle').checked = false;
}
}

// é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–ä¸»é¡Œ
document.addEventListener('DOMContentLoaded', initializeTheme);

// ç²å–æ–°èªéŒ„
function getNewQuote() {
fetch('/get_quote')
.then(response => {
if (!response.ok) {
throw new Error('Network response was not ok');
}
return response.json();
})
.then(data => {
document.getElementById('quoteDisplay').textContent = data.quote;
})
.catch(error => {
console.error('Error fetching quote:', error);
// å¦‚æœAPIå¤±æ•—ï¼Œå¾æœ¬åœ°èªéŒ„ä¸­éš¨æ©Ÿé¸æ“‡ä¸€å€‹
const fallbackQuotes = [
"ç›¸ä¿¡è‡ªå·±ï¼Œä½ æ¯”æƒ³åƒä¸­æ›´å¼·å¤§ï¼",
"æ¯ä¸€å¤©éƒ½æ˜¯æ–°çš„é–‹å§‹ï¼Œæ”¾ä¸‹éå»ï¼Œæ“æŠ±ç¾åœ¨ã€‚",
"ä½ çš„åƒ¹å€¼ä¸éœ€è¦ç”±ä»–äººä¾†å®šç¾©ã€‚",
"å°å°çš„é€²æ­¥ä¹Ÿæ˜¯é€²æ­¥ï¼Œç‚ºè‡ªå·±é¼“æŒã€‚"
];
document.getElementById('quoteDisplay').textContent =
fallbackQuotes[Math.floor(Math.random() * fallbackQuotes.length)];
});
}

// åˆ‡æ›æ·±è‰²æ¨¡å¼
function toggleDarkMode() {
darkMode = !darkMode;

if (darkMode) {
document.body.classList.remove('theme-light');
document.body.classList.add('theme-dark');
} else {
document.body.classList.remove('theme-dark');
document.body.classList.add('theme-light');
}

// ä¿å­˜åå¥½åˆ°æœ¬åœ°å„²å­˜
localStorage.setItem('darkMode', darkMode);

// ç™¼é€åˆ°ä¼ºæœå™¨ï¼ˆå¯é¸ï¼‰
fetch('/toggle_mode', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ dark_mode: darkMode })
}).catch(error => {
console.error('Error saving theme preference:', error);
});
}
</script>
</body>
</html>
'''

@app.route('/')
def index():
"""é¦–é ï¼Œé¡¯ç¤ºéš¨æ©ŸèªéŒ„"""
random_quote = random.choice(quotes)
# å¾Cookieæˆ–é è¨­å€¼ç²å–ä¸»é¡Œè¨­å®š
dark_mode = request.cookies.get('dark_mode', 'false') == 'true'
return render_template_string(HTML_TEMPLATE, quote=random_quote, dark_mode=dark_mode)

@app.route('/get_quote')
def get_quote():
"""ç²å–æ–°çš„éš¨æ©ŸèªéŒ„ (ç”¨æ–¼AJAXè«‹æ±‚)"""
random_quote = random.choice(quotes)
return jsonify({'quote': random_quote})

@app.route('/toggle_mode', methods=['POST'])
def toggle_mode():
"""åˆ‡æ›æ·±è‰²/æ·ºè‰²æ¨¡å¼"""
try:
data = request.get_json()
if data is None:
return jsonify({'error': 'Invalid JSON data'}), 400

dark_mode = data.get('dark_mode', False)

# åœ¨å¯¦éš›æ‡‰ç”¨ä¸­ï¼Œé€™è£¡å¯ä»¥å°‡ç”¨æˆ¶åå¥½ä¿å­˜åˆ°è³‡æ–™åº«æˆ–Cookie
response = jsonify({'dark_mode': dark_mode, 'message': 'Theme preference updated'})
response.set_cookie('dark_mode', str(dark_mode).lower(), max_age=30*24*60*60) # 30å¤©

return response
except Exception as e:
return jsonify({'error': str(e)}), 500

@app.route('/health')
def health_check():
"""å¥åº·æª¢æŸ¥ç«¯é»"""
return jsonify({'status': 'healthy', 'quotes_count': len(quotes)})

@app.errorhandler(404)
def page_not_found(e):
"""è™•ç†404éŒ¯èª¤"""
return jsonify({'error': 'Page not found'}), 404

@app.errorhandler(500)
def internal_server_error(e):
"""è™•ç†500éŒ¯èª¤"""
return jsonify({'error': 'Internal server error'}), 500

if __name__ == '__main__':
# æª¢æŸ¥Flaskç‰ˆæœ¬
try:
import flask
print(f"Flaskç‰ˆæœ¬: {flask.__version__}")
except ImportError:
print("éŒ¯èª¤: Flaskæœªå®‰è£ã€‚è«‹åŸ·è¡Œ: pip install flask")
exit(1)

# è¨­ç½®Flaské…ç½®
app.config['JSON_AS_ASCII'] = False # ç¢ºä¿JSONæ­£ç¢ºè™•ç†ä¸­æ–‡
app.config['TEMPLATES_AUTO_RELOAD'] = True

print("=" * 50)
print("å‹µå¿—èªéŒ„ç¶²ç«™å•Ÿå‹•ä¸­...")
print(f"èªéŒ„æ•¸é‡: {len(quotes)} æ¢")
print("è¨ªå•åœ°å€: http://localhost:5000")
print("å¥åº·æª¢æŸ¥: http://localhost:5000/health")
print("=" * 50)

# å•Ÿå‹•ä¼ºæœå™¨
app.run(debug=True, host='0.0.0.0', port=5000)

